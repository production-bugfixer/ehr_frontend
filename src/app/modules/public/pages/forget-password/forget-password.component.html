<div class="container d-flex justify-content-center align-items-center min-vh-100 bg-light py-4">
  <div class="card shadow-sm w-100" style="max-width: 500px;">
    <!-- Green header -->
    <div class="card-header bg-primary text-white text-center">
      <h2 class="mb-0">{{ 'FORGET_PASSWORD.TITLE' | translate }}</h2>
    </div>

    <div class="card-body bg-white">
     <!-- Display requestId if present -->
<div *ngIf="requestId" class="alert alert-success d-flex align-items-center mt-3" role="alert">
  <i class="bi bi-check-circle-fill me-2 fs-5 text-success"></i>
  <div class="flex-grow-1">
    <strong>{{ 'FORGET_PASSWORD.REQUEST_ID' | translate }}:</strong>
    <span class="ms-1">{{ requestId }}</span>
  </div>
</div>

      <form *ngIf="!verificationSent" (ngSubmit)="requestOTP()" [formGroup]="forgotPasswordForm">
        <div class="mb-3">
          <label for="ehrId" class="form-label">{{ 'FORGET_PASSWORD.EHR_ID' | translate }}</label>
          <input
            id="ehrId"
            type="email"
            formControlName="ehrId"
            class="form-control"
            placeholder="{{ 'FORGET_PASSWORD.EHR_ID_PLACEHOLDER' | translate }}"
          />
          <div *ngIf="forgotPasswordForm.controls['ehrId'].invalid && forgotPasswordForm.controls['ehrId'].touched" class="text-danger small mt-1">
            <span *ngIf="forgotPasswordForm.controls['ehrId'].errors?.['required']">
              {{ 'FORGET_PASSWORD.EHR_ID_REQUIRED' | translate }}
            </span>
            <span *ngIf="forgotPasswordForm.controls['ehrId'].errors?.['email']">
              {{ 'FORGET_PASSWORD.EHR_ID_INVALID' | translate }}
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">{{ 'FORGET_PASSWORD.VERIFICATION_METHOD' | translate }}</label>
          <div class="btn-group w-100">
            <button
              type="button"
              class="btn btn-outline-primary"
              [class.active]="verificationMethod === 'email'"
              (click)="onVerificationMethodChange('email')"
            >
              {{ 'FORGET_PASSWORD.EMAIL' | translate }}
            </button>
            <button
              type="button"
              class="btn btn-outline-primary"
              [class.active]="verificationMethod === 'phone'"
              (click)="onVerificationMethodChange('phone')"
            >
              {{ 'FORGET_PASSWORD.PHONE' | translate }}
            </button>
          </div>
        </div>

        <button type="submit" class="btn btn-primary w-100" [disabled]="loading || forgotPasswordForm.invalid">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          {{ 'FORGET_PASSWORD.SEND_OTP' | translate }}
        </button>

        <div *ngIf="requestId" class="alert alert-info mt-3">
          {{ 'FORGET_PASSWORD.REQUEST_ID' | translate }}: {{ requestId }}
        </div>
      </form>

      <!-- Step 2: Reset Password -->
      <form *ngIf="showResetFields" (ngSubmit)="resetPassword()" [formGroup]="forgotPasswordForm" class="mt-3">
        <div class="mb-3">
          <label for="otp" class="form-label">{{ 'FORGET_PASSWORD.OTP' | translate }}</label>
          <input
            id="otp"
            type="text"
            formControlName="otp"
            class="form-control"
            placeholder="{{ 'FORGET_PASSWORD.OTP_PLACEHOLDER' | translate }}"
          />
          <div *ngIf="forgotPasswordForm.controls['otp'].invalid && forgotPasswordForm.controls['otp'].touched" class="text-danger small mt-1">
            {{ 'FORGET_PASSWORD.OTP_REQUIRED' | translate }}
          </div>
        </div>

        <div class="mb-3">
          <label for="newPassword" class="form-label">{{ 'FORGET_PASSWORD.NEW_PASSWORD' | translate }}</label>
          <input
            id="newPassword"
            type="password"
            formControlName="newPassword"
            class="form-control"
            placeholder="{{ 'FORGET_PASSWORD.NEW_PASSWORD_PLACEHOLDER' | translate }}"
          />
          <div *ngIf="forgotPasswordForm.controls['newPassword'].invalid && forgotPasswordForm.controls['newPassword'].touched" class="text-danger small mt-1">
            <span *ngIf="forgotPasswordForm.controls['newPassword'].errors?.['required']">
              {{ 'FORGET_PASSWORD.PASSWORD_REQUIRED' | translate }}
            </span>
            <span *ngIf="forgotPasswordForm.controls['newPassword'].errors?.['minlength']">
              {{ 'FORGET_PASSWORD.PASSWORD_MIN_LENGTH' | translate }}
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label for="confirmPassword" class="form-label">{{ 'FORGET_PASSWORD.CONFIRM_PASSWORD' | translate }}</label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            class="form-control"
            placeholder="{{ 'FORGET_PASSWORD.CONFIRM_PASSWORD_PLACEHOLDER' | translate }}"
          />
          <div *ngIf="forgotPasswordForm.controls['confirmPassword'].invalid && forgotPasswordForm.controls['confirmPassword'].touched" class="text-danger small mt-1">
            {{ 'FORGET_PASSWORD.CONFIRM_PASSWORD_REQUIRED' | translate }}
          </div>
          <div *ngIf="forgotPasswordForm.errors?.mismatch" class="text-danger small mt-1">
            {{ 'FORGET_PASSWORD.PASSWORDS_MISMATCH' | translate }}
          </div>
        </div>

        <button type="submit" class="btn btn-primary w-100" [disabled]="loading || forgotPasswordForm.invalid">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          {{ 'FORGET_PASSWORD.RESET_PASSWORD' | translate }}
        </button>
      </form>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="alert alert-danger mt-3">
        {{ errorMessage }}
      </div>
    </div>
  </div>
</div>
